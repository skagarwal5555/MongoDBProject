//Find users with rating greater than 4
db.user.find(
	{
		"rating" : { $gt : 4}
	},
	{
		"firstname":1,
		"lastname":1,
		rating":1
	}
  ).pretty();
	
	
//update user rating for a trip provided by the driver
db.user.update({ "_id":1, "ridesTaken.tripId" : 100 }, { $set : { "ridesTaken.$.riderRating" : 2.5 }});

//Find and verify record after update
db.user.aggregate( 
	  {$unwind: "$ridesTaken"},
	  {$match: { "_id":1, "ridesTaken.tripId" : 100 }},
      {
		$project: 
		{
			"firstname":1,"lastname":1,"rating":1, "ridesTaken.tripId":1, "ridesTaken.riderRating":1
		}
	  }
    ).pretty();

//calculate total rating of user
db.user.aggregate( [
   { $match: { _id: 1 } },
   {
     $set: {
        rating: { $avg: "$ridesTaken.riderRating" }
     }
   },
      {
		$project: 
		{
			"firstname":1,
			"lastname":1,
			"rating":1
		}
	  }
]).pretty();


//update the geolocation of the user
db.user.update({ "_id":1 },{
	$set: { currentGeoLocation : { type: "Point", coordinates: [ -73.88, 43.78 ] } }
 });
 
 
//Delete a Saved Address by addr1
db.user.update({"_id":1}, { $pull: { "savedAddress" : { "addr1": /6209/ } }} );

//verify address is deleted
db.user.find({ "_id":1 } , { "firstname":1,"lastname":1, "savedAddress" :1}).pretty();




